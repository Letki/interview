### 一. 一次完整的HTTP请求所经历的7个步骤
##### 1.  建立TCP连接

在HTTP工作开始之前，Web浏览器首先要通过网络与Web服务器建立连接，该连接是通过TCP来完成的，该协议与IP协议共同构建 Internet，即著名的TCP/IP协议族，因此Internet又被称作是TCP/IP网络。HTTP是比TCP更高层次的应用层协议，根据规则， 只有低层协议建立之后才能，才能进行更层协议的连接，因此，首先要建立TCP连接，一般TCP连接的端口号是80。
###### <延伸知识> tcp三次握手

##### 2. Web浏览器向Web服务器发送请求命令 

一旦建立了TCP连接，Web浏览器就会向Web服务器发送请求命令。例如：GET/sample/hello.jsp HTTP/1.1。

##### 3. Web浏览器发送请求头信息 

浏览器发送其请求命令之后，还要以头信息的形式向Web服务器发送一些别的信息，之后浏览器发送了一**空白行**来通知服务器，它已经结束了该头信息的发送。 

##### 4. Web服务器应答 

客户机向服务器发出请求后，服务器会客户机回送应答， HTTP/1.1 200 OK ，应答的第一部分是协议的版本号和应答状态码。

##### 5. Web服务器发送应答头信息 

正如客户端会随同请求发送关于自身的信息一样，服务器也会随同应答向用户发送关于它自己的数据及被请求的文档。 

##### 6. Web服务器向浏览器发送数据 

Web服务器向浏览器发送头信息后，它会发送一个**空白行**来表示头信息的发送到此为结束，接着，它就以Content-Type应答头信息所描述的格式发送用户所请求的实际数据。

##### 7. Web服务器关闭TCP连接 

一般情况下，一旦Web服务器向浏览器发送了请求数据，它就要关闭TCP连接，然后如果浏览器或者服务器在其头信息加入了这行代码：
###### Connection:keep-alive 
TCP连接在发送后将仍然保持打开状态，于是，浏览器可以继续通过相同的连接发送请求。保持连接节省了为每个请求建立新连接所需的时间，还节约了网络带宽。
###### <延伸知识> TCP四次挥手



<br>

### 请求报文和响应报文
##### 请求报文：它会向Web服务器请求一个动作

请求报文的格式：
- 起始行： <method> <request-URL> <version>
- 头部：   <headers>
- 主体：   <entity-body>

![image](https://pic002.cnblogs.com/images/2012/426620/2012072810301161.png)

##### 起始行
所有的HTTP报文都以一个起始行作为开始。请求报文的起始行说明了要做些什么。响应报文的起始行说明发生了什么。

请求报文的起始行：该行包含了一个方法和一个请求的URL，还包含HTTP 的版本。

响应报文的起始行：该行包含了响应报文使用的HTTP版本、**数字状态码**、原因短语。
###### <延伸知识> 各状态码的区别

##### 请求头

请求行由请求方法字段、URL字段和HTTP协议版本字段3个字段组成，它们用空格分隔。例如，GET /index.html HTTP/1.1。

HTTP协议的请求方法有GET、POST、HEAD、PUT、DELETE、OPTIONS、TRACE、CONNECT。

###### <延伸知识> post和get的区别

<br><br><br>

##### 请求头部

请求头部由关键字/值对组成，每行一对，关键字和值用英文冒号“:”分隔。请求头部通知服务器有关于客户端请求的信息，典型的请求头有：
- User-Agent：产生请求的浏览器类型。
- Accept：客户端可识别的内容类型列表。
- Host：请求的主机名，允许多个域名同处一个IP地址，即虚拟主机。

######  请求头部：请求头部是只在请求报文中有意义的头部。用于说明是谁或什么在发送请求、请求源自何处，或者客户端的喜好及能力
- Client-IP：提供了运行客户端的机器的IP地址
- From：提供了客户端用户的E-mail地址
- Host：给出了接收请求的服务器的主机名和端口号
- Referer：提供了包含当前请求URI的文档的URL
- UA-Color：提供了与客户端显示器的显示颜色有关的信息
- UA-CPU：给出了客户端CPU的类型或制造商
- UA-OS：给出了运行在客户端机器上的操作系统名称及版本
- UA-Pixels：提供了客户端显示器的像素信息
- User-Agent：将发起请求的应用程序名称告知服务器       
- Accept：告诉服务器能够发送哪些媒体类型
- Accept-Charset：告诉服务器能够发送哪些字符集
- Accept-Encoding：告诉服务器能够发送哪些编码方式
- Accept-Language：告诉服务器能够发送哪些语言
- TE：告诉服务器可以使用那些扩展传输编码
- Expect：允许客户端列出某请求所要求的服务器行为
- Range：如果服务器支持范围请求，就请求资源的指定范围
- If-Match：如果实体标记与文档当前的实体标记相匹配，就获取这份文档
- If-Modified-Sinec：除非在某个指定的日期之后资源被修改过，否则就限制这个请求
- If-None-Match：如果提供的实体标记与当前文档的实体标记不相符，就获取文档
- If-Range：允许对文档的某个范围进行条件请求
- If-Unmodified-Since：除非在某个指定日期之后资源没有被修改过，否则就限制这个请求
- Authorization：包含了客户端提供给服务器，以便对其自身进行认证的数据
- Cookie：客户端用它向服务器传送数据
- Cookie2：用来说明请求端支持的cookie版本
- Max-Forward：在通往源端服务器的路径上，将请求转发给其他代理或网关的最大次数
- Proxy-Authorization：这个首部在与代理进行认证时使用的
- Proxy-Connection：这个首部是在与代理建立连接时使用的

##### 响应头部：响应头部为客户端提供了一些额外信息，比如谁在发送响应、响应者的功能，甚至与响应相关的一些特殊指令
- Age：(从最初创建开始)响应持续时间
- Public：服务器为其资源支持的请求方法列表
- Retry-After：如果资源不可用的话，在此日期或时间重试
- Server：服务器应用程序软件的名称和版本
- Title：对HTML文档来说，就是HTML文档的源端给出的标题
- Warning：比原因短语更详细一些的警告报文
- Accept-Ranges：对此资源来说，服务器可接受的范围类型
- Vary：服务器会根据这些首部的内容挑选出最适合的资源版本发送给客户端
- Proxy-Authenticate：来自代理的对客户端的质询列表
- Set-Cookie：在客户端设置数据，以便服务器对客户端进行标识
- Set-Cookie2：与Set-Cookie类似
- WWW-Authenticate：来自服务器的对客户端的质询列表


##### 实体首部
描述主体的长度和内容，或者资源自身
- Allow：列出了可以对此实体执行的请求方法
- Location：告知客户端实体实际上位于何处，用于将接收端定向到资源的位置(URL)上去
- Content-Base：解析主体中的相对URL时使用的基础URL
- Content-Encoding：对主体执行的任意编码方式
- Content-Language：理解主体时最适宜使用的自然语言
- Content-Length：主体的长度
- Content-Location：资源实际所处的位置
- Content-MD5：主体的MD5校验和
- Content-Range：在整个资源中此实体表示的字节范围
- Content-Type：这个主体的对象类型
- ETag：与此实体相关的实体标记
- Expires：实体不再有效，要从原始的源端再次获取实体的日期和时间
- Last-Modified：这个实体最后一次被修改的日期和时间
- 扩展首部：规范中没有定义的新首部，开发者可以自定义一个首部的值/对


##### 实体的主体部分
该部分其实就是HTTP要传输的内容，是可选的。HTTP报文可以承载很多类型的数字数据，比如，图片、视频、HTML文档电子邮件、软件应用程序等等。